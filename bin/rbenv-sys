#!/usr/bin/env bash 
# Summary: manage ruby system version
# 
# Usage: rbenv sys

set -e
system_ruby_file=/etc/profile.d/system-ruby.sh

action=$1
if [ -z "$action" ];then
  if [ -f $system_ruby_file ];then
    exec cat $system_ruby_file
  else
    echo No system ruby
  fi
  exit 
fi
shift

case $action in
  ls)
    exec rbenv-versions --bare
    ;;
  *)
    version=$action
    [ -z "$version" ] && echo No version && exit 1
    tmp_file=/tmp/system-ruby.sh
    bin_path=$(rbenv root)/versions/$version/bin
    cat <<-Ruby >$tmp_file
#!/usr/bin/env bash
#Generated by rbenv sys $version on `date`
[ -d $bin_path ] && export PATH=$bin_path:\$PATH
Ruby
    sudo mv -b $tmp_file $system_ruby_file
    ;;
esac
